# Стратегия решения: Gogetlinks Task Parser

## Фреймворк анализа проблемы

### Формулировка проблемы
Gogetlinks.net — биржа заданий для веб-разработчиков — не предоставляет API для автоматического получения списка доступных задач. Необходимо создать парсер для автоматического сбора информации о заданиях с последующим хранением в БД для отслеживания новых возможностей.

### Декомпозиция по первым принципам

#### Основная истина 1: Проблема доступа к данным
**Фундаментальная природа:**
- Данные существуют (публичные задания на сайте)
- Доступ ограничен авторизацией + капча
- Структура данных присутствует в HTML (парсится человеком визуально)

**Следствие:** Browser automation — единственный способ имитировать человеческий доступ.

#### Основная истина 2: Проблема автоматизации
**Фундаментальная природа:**
- Периодическое повторение одних и тех же действий (login → navigate → parse)
- Необходимость различения новых и уже обработанных заданий
- Требование минимального вмешательства пользователя

**Следствие:** Cron scheduling + database deduplication + comprehensive logging.

#### Основная истина 3: Проблема защиты от ботов
**Фундаментальная природа:**
- Капча спроектирована для различения человека и бота
- Anti-captcha.org решает капчу руками реальных людей → фактически делегируем "человеческий" шаг

**Следствие:** Интеграция captcha solver — необходимая часть архитектуры.

### Применение паттернов TRIZ

#### Паттерн 1: Посредничество (Mediation)
**Проблема:** Капча блокирует автоматизацию
**TRIZ Решение:** Ввести посредника (anti-captcha.org), который имеет доступ к "человеческому" решению
**Реализация:** Anti-Captcha API + browser plugin

#### Паттерн 2: Предварительное действие (Prior Action)
**Проблема:** Каждый запуск требует полной авторизации
**TRIZ Решение:** Использовать cookie persistence для сохранения сессии между запусками
**Реализация:** Session cookie storage (если сессия валидна → skip auth)

#### Паттерн 3: Дробление (Segmentation)
**Проблема:** Монолитный парсинг всех данных замедляет процесс
**TRIZ Решение:** Разделить на минимальный парсинг (list view) + детальный (detail view)
**Реализация:**
- Фаза 1: Парсинг списка (только базовые поля)
- Фаза 2: Детальный парсинг (только для новых заданий)

#### Паттерн 4: Асимметрия (Asymmetry)
**Проблема:** Одинаковая частота проверки для всех типов задач
**TRIZ Решение:** Разная частота проверки в зависимости от типа (NEW > WAIT > PAID)
**Реализация:** Multiple cron schedules с разными интервалами

## Принципы проектирования решения

### 1. Минимальная жизнеспособная реализация
**Принцип:** Start simple, add complexity only when needed
**Реализация:**
- ✅ No Docker (простой Python script)
- ✅ No retry-логика (базовое логирование)
- ✅ No уведомления (только БД)
- ✅ Headless режим (no GUI на VPS)

### 2. Разделение обязанностей
```
┌─────────────────┐
│  Auth Module    │ → Авторизация + captcha solving
├─────────────────┤
│  Parser Module  │ → HTML extraction + data cleaning
├─────────────────┤
│  Storage Module │ → MySQL insert/update + deduplication
├─────────────────┤
│  Config Module  │ → INI parsing + credentials management
└─────────────────┘
```

### 3. Отказоустойчивый дизайн
**Стратегия:** Log everything, fail gracefully
- Каждая операция логируется с timestamp
- Exceptions не прерывают весь процесс (catch → log → continue)
- Exit codes для мониторинга cron jobs

### 4. Целостность данных
**Стратегия:** UNIQUE INDEX + ON CONFLICT handling
```sql
CREATE UNIQUE INDEX idx_task_id ON tasks(task_id);

INSERT INTO tasks (...) VALUES (...)
ON DUPLICATE KEY UPDATE
    updated_at = NOW(),
    is_new = 0;
```

## Рассмотренные альтернативные подходы

| Подход | Плюсы | Минусы | Решение |
|----------|------|------|----------|
| **API Reverse Engineering** | Прямой доступ к данным | Может сломаться при обновлении, риск блокировки | ❌ Отклонено |
| **Static HTML Parser (requests)** | Быстрее Selenium | Не работает с JavaScript, не пройдёт капчу | ❌ Отклонено |
| **Puppeteer (Node.js)** | Более современный | Требует Node.js, менее популярен для scraping | ❌ Отклонено |
| **Selenium + Python** | Mature ecosystem, обширная документация | Медленнее, больше overhead | ✅ **ВЫБРАНО** |
| **Playwright** | Быстрее Selenium, лучше API | Менее stable для anti-captcha | ⚠️ Future consideration |

## Анализ рисков

### Технические риски

#### Риск 1: Изменение вёрстки сайта
**Вероятность:** Medium
**Влияние:** High (парсер перестанет работать)
**Снижение:**
- Использовать гибкие CSS selectors (не жёсткие XPath)
- Логировать HTML при ошибках парсинга
- Тесты на валидацию структуры данных

#### Риск 2: Капча не решается
**Вероятность:** Low
**Влияние:** Critical (блокировка авторизации)
**Снижение:**
- Логировать все captcha failures с timestamp
- Мониторить баланс anti-captcha аккаунта
- Fallback: manual notification при N последовательных ошибках (будущая версия)

#### Риск 3: IP-блокировка
**Вероятность:** Low (при редких запусках)
**Влияние:** High
**Снижение:**
- Запускать не чаще 1 раза в час
- Random User-Agent rotation (будущая версия)
- Proxy rotation (будущая версия, если потребуется)

### Операционные риски

#### Риск 4: Cron не запустился
**Вероятность:** Medium
**Влияние:** Medium (пропущенные задания)
**Снижение:**
- Логировать каждый запуск в отдельный файл с timestamp
- Exit codes для мониторинга
- Crontab с email notifications на failure (опционально)

#### Риск 5: Переполнение БД
**Вероятность:** Low
**Влияние:** Low (диск заполнится)
**Снижение:**
- Автоматическая архивация старых задач (> 30 дней) в отдельную таблицу
- Мониторинг размера таблицы

## Критерии успеха

### Must Have (MVP)
- [x] Успешная авторизация через anti-captcha
- [x] Парсинг списка новых задач (NEW)
- [x] Сохранение в MySQL с дедупликацией
- [x] Вывод на экран (отключаемый через config)
- [x] Запуск по cron без ошибок

### Should Have (v1.1)
- [ ] Парсинг деталей задания (description, requirements)
- [ ] Session persistence (skip auth if valid)
- [ ] Retry-логика для transient errors
- [ ] Email notifications на новые задания

### Could Have (v2.0)
- [ ] Telegram bot для уведомлений
- [ ] Фильтрация задач по критериям (цена, deadline)
- [ ] Web UI для просмотра задач
- [ ] Proxy rotation для масштабирования

## Стратегия реализации

### Фаза 1: Базовая функциональность (MVP)
**Сроки:** 2-3 дня
**Результаты:**
1. Auth module + captcha solving
2. Parser module (list view only)
3. MySQL schema + insert logic
4. Config management (INI)
5. Basic logging

### Фаза 2: Надёжность (v1.1)
**Сроки:** 1-2 дня
**Результаты:**
1. Detail parsing (description, requirements, contacts)
2. Session persistence
3. Retry decorator для нестабильных операций
4. Enhanced error handling

### Фаза 3: Мониторинг (v2.0)
**Сроки:** 2-3 дня
**Результаты:**
1. Telegram bot integration
2. Filtering engine
3. Web dashboard (Flask + Bootstrap)

## Проверка ограничений

✅ **Python** — основной язык
✅ **Selenium** — browser automation
✅ **MySQL** — database
✅ **No Docker** — прямой запуск на VPS
✅ **Cron** — scheduler
✅ **Anti-Captcha** — captcha solver
✅ **Headless Chrome** — VPS compatibility

---

**Уровень уверенности:** Высокий (95%)
**Обоснование:** Все компоненты проверены research фазой, нет технологических блокеров.
